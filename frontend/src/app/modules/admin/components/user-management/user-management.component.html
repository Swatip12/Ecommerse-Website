<div class="user-management">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">User Management</h1>
      <button (click)="openCreateModal()" class="create-btn">
        <span class="icon">➕</span>
        Create User
      </button>
    </div>
  </div>

  <!-- Search and Filters -->
  <div class="search-section">
    <div class="search-bar">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (keyup.enter)="onSearch()"
        placeholder="Search by email, first name, or last name..."
        class="search-input">
      <button (click)="onSearch()" class="search-btn">Search</button>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    <span class="error-icon">⚠️</span>
    {{ error }}
    <button (click)="loadUsers()" class="retry-btn">Retry</button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading users...</p>
  </div>

  <!-- Users Table -->
  <div *ngIf="!loading" class="users-table-container">
    <table class="users-table">
      <thead>
        <tr>
          <th>User ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Status</th>
          <th>Email Verified</th>
          <th>Created</th>
          <th>Last Login</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of users" class="user-row">
          <td>{{ user.userId }}</td>
          <td class="user-name">
            <div class="name-container">
              <span class="full-name">{{ user.firstName }} {{ user.lastName }}</span>
            </div>
          </td>
          <td>{{ user.email }}</td>
          <td>
            <span class="role-badge" [ngClass]="getRoleColor(user.role)">
              {{ user.role }}
            </span>
          </td>
          <td>
            <span class="status-badge" [ngClass]="getStatusColor(user.isActive)">
              {{ user.isActive ? 'Active' : 'Inactive' }}
            </span>
          </td>
          <td>
            <span class="verification-badge" [ngClass]="user.emailVerified ? 'verified' : 'unverified'">
              {{ user.emailVerified ? '✓ Verified' : '✗ Unverified' }}
            </span>
          </td>
          <td>{{ formatDate(user.createdAt) }}</td>
          <td>{{ user.lastLoginAt ? formatDate(user.lastLoginAt) : 'Never' }}</td>
          <td class="actions-cell">
            <div class="action-buttons">
              <button (click)="openEditModal(user)" class="action-btn edit-btn" title="Edit User">
                ✏️
              </button>
              <button (click)="toggleUserStatus(user)" 
                      class="action-btn toggle-btn" 
                      [title]="user.isActive ? 'Deactivate User' : 'Activate User'">
                {{ user.isActive ? '🔒' : '🔓' }}
              </button>
              <button (click)="resetUserPassword(user)" class="action-btn reset-btn" title="Reset Password">
                🔑
              </button>
              <button (click)="openDeleteModal(user)" class="action-btn delete-btn" title="Delete User">
                🗑️
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div *ngIf="users.length === 0" class="empty-state">
      <div class="empty-icon">👥</div>
      <h3>No users found</h3>
      <p>{{ searchTerm ? 'Try adjusting your search criteria' : 'Create your first user to get started' }}</p>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="!loading && users.length > 0" class="pagination">
    <div class="pagination-info">
      Showing {{ (currentPage * pageSize) + 1 }} to {{ Math.min((currentPage + 1) * pageSize, totalUsers) }} of {{ totalUsers }} users
    </div>
    <div class="pagination-controls">
      <button (click)="onPageChange(currentPage - 1)" 
              [disabled]="currentPage === 0" 
              class="page-btn">
        Previous
      </button>
      
      <button *ngFor="let page of getPageNumbers()" 
              (click)="onPageChange(page)"
              [class.active]="page === currentPage"
              class="page-btn page-number">
        {{ page + 1 }}
      </button>
      
      <button (click)="onPageChange(currentPage + 1)" 
              [disabled]="currentPage >= getTotalPages() - 1" 
              class="page-btn">
        Next
      </button>
    </div>
  </div>
</div>

<!-- Create User Modal -->
<div *ngIf="showCreateModal" class="modal-overlay" (click)="closeCreateModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Create New User</h2>
      <button (click)="closeCreateModal()" class="close-btn">✕</button>
    </div>
    
    <form [formGroup]="createUserForm" (ngSubmit)="onCreateUser()" class="user-form">
      <div class="form-row">
        <div class="form-group">
          <label for="email">Email *</label>
          <input type="email" id="email" formControlName="email" class="form-input">
          <div *ngIf="createUserForm.get('email')?.invalid && createUserForm.get('email')?.touched" class="field-error">
            Email is required and must be valid
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="firstName">First Name *</label>
          <input type="text" id="firstName" formControlName="firstName" class="form-input">
          <div *ngIf="createUserForm.get('firstName')?.invalid && createUserForm.get('firstName')?.touched" class="field-error">
            First name is required
          </div>
        </div>
        
        <div class="form-group">
          <label for="lastName">Last Name *</label>
          <input type="text" id="lastName" formControlName="lastName" class="form-input">
          <div *ngIf="createUserForm.get('lastName')?.invalid && createUserForm.get('lastName')?.touched" class="field-error">
            Last name is required
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="password">Password *</label>
          <input type="password" id="password" formControlName="password" class="form-input">
          <div *ngIf="createUserForm.get('password')?.invalid && createUserForm.get('password')?.touched" class="field-error">
            Password must be at least 8 characters
          </div>
        </div>
        
        <div class="form-group">
          <label for="role">Role *</label>
          <select id="role" formControlName="role" class="form-select">
            <option value="CUSTOMER">Customer</option>
            <option value="ADMIN">Admin</option>
          </select>
        </div>
      </div>
      
      <div class="modal-actions">
        <button type="button" (click)="closeCreateModal()" class="cancel-btn">Cancel</button>
        <button type="submit" [disabled]="createUserForm.invalid" class="submit-btn">Create User</button>
      </div>
    </form>
  </div>
</div>

<!-- Edit User Modal -->
<div *ngIf="showEditModal" class="modal-overlay" (click)="closeEditModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Edit User</h2>
      <button (click)="closeEditModal()" class="close-btn">✕</button>
    </div>
    
    <form [formGroup]="editUserForm" (ngSubmit)="onUpdateUser()" class="user-form">
      <div class="form-row">
        <div class="form-group">
          <label for="editFirstName">First Name</label>
          <input type="text" id="editFirstName" formControlName="firstName" class="form-input">
        </div>
        
        <div class="form-group">
          <label for="editLastName">Last Name</label>
          <input type="text" id="editLastName" formControlName="lastName" class="form-input">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="editRole">Role *</label>
          <select id="editRole" formControlName="role" class="form-select">
            <option value="CUSTOMER">Customer</option>
            <option value="ADMIN">Admin</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="isActive">
            <span class="checkbox-text">Active User</span>
          </label>
        </div>
      </div>
      
      <div class="modal-actions">
        <button type="button" (click)="closeEditModal()" class="cancel-btn">Cancel</button>
        <button type="submit" [disabled]="editUserForm.invalid" class="submit-btn">Update User</button>
      </div>
    </form>
  </div>
</div>

<!-- Delete User Modal -->
<div *ngIf="showDeleteModal" class="modal-overlay" (click)="closeDeleteModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Delete User</h2>
      <button (click)="closeDeleteModal()" class="close-btn">✕</button>
    </div>
    
    <div class="modal-body">
      <p>Are you sure you want to delete this user?</p>
      <div *ngIf="selectedUser" class="user-details">
        <strong>{{ selectedUser.firstName }} {{ selectedUser.lastName }}</strong><br>
        <span>{{ selectedUser.email }}</span>
      </div>
      <p class="warning-text">This action cannot be undone.</p>
    </div>
    
    <div class="modal-actions">
      <button (click)="closeDeleteModal()" class="cancel-btn">Cancel</button>
      <button (click)="onDeleteUser()" class="delete-btn">Delete User</button>
    </div>
  </div>
</div>