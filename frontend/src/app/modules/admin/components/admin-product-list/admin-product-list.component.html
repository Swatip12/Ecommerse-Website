<div class="admin-product-list">
  <!-- Header -->
  <div class="header">
    <h2>Product Management</h2>
    <button mat-raised-button color="primary" (click)="createProduct()">
      <mat-icon>add</mat-icon>
      Add Product
    </button>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search products</mat-label>
      <input matInput [(ngModel)]="searchTerm" placeholder="Search by name, SKU, or description">
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Category</mat-label>
      <mat-select [(value)]="selectedCategory">
        <mat-option [value]="null">All Categories</mat-option>
        <mat-option *ngFor="let category of categories" [value]="category.id">
          {{category.name}}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Brand</mat-label>
      <mat-select [(value)]="selectedBrand">
        <mat-option [value]="null">All Brands</mat-option>
        <mat-option *ngFor="let brand of brands" [value]="brand">
          {{brand}}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Status</mat-label>
      <mat-select [(value)]="selectedStatus">
        <mat-option [value]="null">All Status</mat-option>
        <mat-option [value]="true">Active</mat-option>
        <mat-option [value]="false">Inactive</mat-option>
      </mat-select>
    </mat-form-field>

    <div class="price-range">
      <mat-form-field appearance="outline" class="price-field">
        <mat-label>Min Price</mat-label>
        <input matInput type="number" [(ngModel)]="minPrice" min="0">
      </mat-form-field>
      <mat-form-field appearance="outline" class="price-field">
        <mat-label>Max Price</mat-label>
        <input matInput type="number" [(ngModel)]="maxPrice" min="0">
      </mat-form-field>
    </div>

    <div class="filter-actions">
      <button mat-raised-button color="primary" (click)="applyFilter()">
        <mat-icon>filter_list</mat-icon>
        Apply Filters
      </button>
      <button mat-button (click)="clearFilters()">
        <mat-icon>clear</mat-icon>
        Clear
      </button>
    </div>
  </div>

  <!-- Bulk Actions -->
  <div class="bulk-actions" *ngIf="selection.selected.length > 0">
    <span class="selection-info">{{selection.selected.length}} products selected</span>
    
    <button mat-button color="warn" (click)="bulkDelete()">
      <mat-icon>delete</mat-icon>
      Delete Selected
    </button>
    
    <button mat-button (click)="bulkActivate()">
      <mat-icon>check_circle</mat-icon>
      Activate Selected
    </button>
    
    <button mat-button (click)="bulkDeactivate()">
      <mat-icon>cancel</mat-icon>
      Deactivate Selected
    </button>
  </div>

  <!-- Export Actions -->
  <div class="export-actions">
    <button mat-button (click)="exportToCSV()">
      <mat-icon>download</mat-icon>
      Export to CSV
    </button>
  </div>

  <!-- Products Table -->
  <div class="table-container">
    <table mat-table [dataSource]="dataSource" matSort class="products-table">
      
      <!-- Checkbox Column -->
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox (change)="$event ? masterToggle() : null"
                        [checked]="selection.hasValue() && isAllSelected()"
                        [indeterminate]="selection.hasValue() && !isAllSelected()">
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let product">
          <mat-checkbox (click)="$event.stopPropagation()"
                        (change)="$event ? selection.toggle(product) : null"
                        [checked]="selection.isSelected(product)">
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- Image Column -->
      <ng-container matColumnDef="image">
        <th mat-header-cell *matHeaderCellDef>Image</th>
        <td mat-cell *matCellDef="let product">
          <img [src]="getPrimaryImageUrl(product)" 
               [alt]="product.name" 
               class="product-image">
        </td>
      </ng-container>

      <!-- SKU Column -->
      <ng-container matColumnDef="sku">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>SKU</th>
        <td mat-cell *matCellDef="let product">{{product.sku}}</td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
        <td mat-cell *matCellDef="let product">
          <div class="product-name">{{product.name}}</div>
          <div class="product-description" *ngIf="product.description">
            {{product.description | slice:0:100}}{{product.description.length > 100 ? '...' : ''}}
          </div>
        </td>
      </ng-container>

      <!-- Category Column -->
      <ng-container matColumnDef="category">
        <th mat-header-cell *matHeaderCellDef>Category</th>
        <td mat-cell *matCellDef="let product">{{product.category?.name}}</td>
      </ng-container>

      <!-- Brand Column -->
      <ng-container matColumnDef="brand">
        <th mat-header-cell *matHeaderCellDef>Brand</th>
        <td mat-cell *matCellDef="let product">{{product.brand || 'N/A'}}</td>
      </ng-container>

      <!-- Price Column -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Price</th>
        <td mat-cell *matCellDef="let product">
          <span class="price">${{product.price | number:'1.2-2'}}</span>
        </td>
      </ng-container>

      <!-- Inventory Column -->
      <ng-container matColumnDef="inventory">
        <th mat-header-cell *matHeaderCellDef>Inventory</th>
        <td mat-cell *matCellDef="let product">
          <div class="inventory-info">
            <span class="quantity">{{product.inventory?.quantityAvailable || 0}}</span>
            <mat-chip [class]="getInventoryClass(product)" class="inventory-status">
              {{getInventoryStatus(product)}}
            </mat-chip>
          </div>
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let product">
          <mat-chip [class]="getStatusClass(product.isActive)">
            {{getStatusText(product.isActive)}}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let product">
          <button mat-icon-button [matMenuTriggerFor]="menu">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="editProduct(product)">
              <mat-icon>edit</mat-icon>
              <span>Edit</span>
            </button>
            <button mat-menu-item (click)="deleteProduct(product)">
              <mat-icon>delete</mat-icon>
              <span>Delete</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let product; columns: displayedColumns;"></tr>
    </table>

    <!-- Loading indicator -->
    <div class="loading-container" *ngIf="loading">
      <mat-spinner></mat-spinner>
    </div>

    <!-- No data message -->
    <div class="no-data" *ngIf="!loading && dataSource.data.length === 0">
      <mat-icon>inventory_2</mat-icon>
      <h3>No products found</h3>
      <p>Try adjusting your filters or create a new product.</p>
    </div>
  </div>

  <!-- Paginator -->
  <mat-paginator 
    [length]="totalElements"
    [pageSize]="pageSize"
    [pageSizeOptions]="[10, 20, 50, 100]"
    showFirstLastButtons>
  </mat-paginator>
</div>